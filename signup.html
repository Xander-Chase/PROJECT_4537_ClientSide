<!DOCTYPE html>
<html>  
<head>
    <title>Sign Up</title>
    <link rel="stylesheet" href="./public/styles/styles.css">
    <link rel="stylesheet" href="./public/styles/authPanel.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body onload="NavigateUserProperlyAuthPage()">
    <div class="main_container">
        <div class="form_container container col-xl-10 col-xxl-8 px-4 py-5 shadow-lg bg-body-tertiary">
            <div class="row align-items-center g-lg-5 py-5">
                <div class="col-lg-7 text-center text-lg-start">
                    <h1 class="display-4 fw-bold lh-1 text-body-emphasis mb-3">
                        Just Choose Your Own Adventure!
                    </h1>
                    <p class="col-lg-10 fs-4">
                        Create your own account and let your imaginations run wild with our AI model that will generate a story based on your prompt and guide your path through ideas and creativity.
                    </p>
                </div>
                <div class="col-md-10 mx-auto col-lg-5">
                    <!-- Signup Form -->
                    <form 
                        id="signupForm" 
                        class="p-4 p-md-5 border rounded-3 bg-body-tertiary"
                        onsubmit="handleSignup(event)">

                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="floatingUsername" placeholder="Username" required>
                            <label for="floatingUsername">Username</label>
                        </div>

                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="floatingEmail" placeholder="name@example.com" required>
                            <label for="floatingEmail">Email address</label>
                        </div>

                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="floatingPassword" placeholder="Password" required>
                            <label for="floatingPassword">Password</label>
                        </div>

                        <button class="w-100 btn btn-lg btn-primary" type="submit">Sign up</button>
                        <hr class="my-4">
                        <small class="text-body-primary">
                            If you have an account, <span class="anchorLinkDesign" onclick="window.location.href = 'index.html'">Login!</span>
                        </small>
                        <br>
                        <small class="text-body-secondary">By clicking Sign up, you agree to the terms of use.</small>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="./public/scripts/constants.js"></script>
    <script src="./public/scripts/Utils.js"></script>
    <script src="./public/scripts/themeChanger.js"></script>
    <script src="./public/scripts/authenicateScript.js"></script>
    <script>
        async function handleSignup(event) {
            event.preventDefault(); // Prevent the page from reloading

            const username = document.getElementById('floatingUsername').value;
            const email = document.getElementById('floatingEmail').value;
            const password = document.getElementById('floatingPassword').value;

            try {
                const response = await Utils.PostFetch(`${API_URL}/api/auth/register`, {
                    username,
                    email,
                    password,
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Signup successful! You can now log in.');
                    window.location.href = 'index.html';
                } else {
                    alert(data.error || 'Signup failed. Please try again.');
                }
            } catch (error) {
                console.error('Network error:', error);
                alert('Network error. Please try again later.');
            }
        }
    </script>
</body>
</html>
